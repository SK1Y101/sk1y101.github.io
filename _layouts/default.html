<!DOCTYPE html>
<html lang="{{ site.lang }}">

  <head>
    {% if page.redirect %}<meta http-equiv="refresh" content="3; url={{ site.baseurl | prepend: site.url }}/" />{% endif %}
    {% include head.html %}
  </head>

  <body class="{% unless site.footer_fixed %}sticky-bottom-footer{% endunless %}">

    <!-- Background Canvas -->
    <canvas id="bgCanvas" style="position: absolute; z-index: -900; width:100%; height:100%;"></canvas>

    <!-- Content container -->
    <div style="{% if site.navbar_fixed %}padding-top: 56px;{% endif %} margin-left:25%; margin-right:25%">
      <!-- Header -->

      {% include header.html %}

      <!-- Content -->

      <div class="container mt-5">
        {{ content }}
      </div>

      <!-- Footer -->

      {% include footer.html %}

    </div>
  </body>

  {% include scripts/jquery.html %}
  {% include scripts/bootstrap.html %}
  {% include scripts/mansory.html %}
  {% include scripts/misc.html %}
  {% include scripts/mathjax.html %}
  {% include scripts/analytics.html %}

  <!-- canvas script -->
  <script type="text/javascript">
    $(function () {
      var requestAnimationFrame = window.requestAnimationFrame ||
                                  window.mozRequestAnimationFrame ||
                                  window.webkitRequestAnimationFrame ||
                                  window.msRequestAnimationFrame ||
                                  function (callback) { window.setTimeout(callback, 1000 / 60); };
      window.requestAnimationFrame = requestAnimationFrame;
    })();

    // background
    var background = document.getElementById("bgCanvas"),
        bgCtx = background.getContext("2d"),
        width = window.innerWidth,
        height = document.body.offsetHeight;
    (height < 400) ? height = 400 : height;

    // set the canvas size
    background.width = width;
    background.height = height;

    //night sky background
    bgCtx.fillStyle = '#04004C'
    bgCtx.fillRect(0, 0, width, height);

    // background stars
    function Star(options) {
      this.size = Math.random() * 2;
      this.speed = Math.random() * .05;
      this.x = options.x;
      this.y = options.y;
    }

    // reset star position when they leave the window
    Star.prototype.reset = function() {
      this.size = Math.random() * 2;
      this.speed = Math.random() * .05;
      this.x = width;
      this.y = Math.random() * height;
    }

    // update background star position
    Star.prototype.update = function() {
      this.x -= this.speed;
      if (this.x < 0) {
        this.reset();
      } else {
        bgCtx.fillRect(this.x, this.y, this.size, this.size);
      }
    }

    // create a shooting star
    function ShootingStar() {
      this.reset();
    }

    // reset function for a shooting star
    ShootingStar.prototype.reset = function() {
      this.x = Math.random() * width;
      this.y = 0;
      this.len = (Math.random() * 80) + 10;
      this.speed = (Math.random() * 10) + 6;
      this.size = (Math.random() * 1) + 0.1;
      // force a shooting star to wait for a random amount of time between .5 and 3.5 seconds
      this.waitTime = new Date().getTime() + (Math.random() * 3000) + 500;
      this.active = false;
    }

    // update the shooting star position
    ShootingStar.prototype.update = function() {
      if (this.active) {
        this.x -= this.speed;
        this.y += this.speed;
        if (this.x < 0 || this.y >= height) {
          this.reset();
        } else {
          bgCtx.lineWidth = this.size;
          bgCtx.beginPath();
          bgCtx.moveTo(this.x, this.y);
          bgCtx.lineTo(this.x + this.len, this.y - this.len);
          bgCtx.stroke();
        }
      } else {
        if (this.waitTime < new Date().getTime()) {
          this.active = true;
        }
      }
    }

    // list of all the entities on screen
    var entities = [];

    //initialise the stars
    for (var i = 0; i < height; i++) {
      entities.push(new Star({
        x: Math.random() * width,
        y: Math.random() * height
      }));
    }

    // Add a shooting star
    entities.push(new ShootingStar());

    // and animate the background
    function animate() {
      bgCtx.fillStyle = "#110E19";
      bgCtx.fillRect(0, 0, width, height);
      bgCtx.fillStyle = "#FFFFFF";
      bgCtx.strokeStyle = "#FFFFFF";

      var entLen = entities.length;

      while (entLen--) {
        entities[entLen].update();
      }
      requestAnimationFrame(animate);
    }
    animate();
  </script>

</html>
