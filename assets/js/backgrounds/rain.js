function RainDrop(){this.reset()}function DripDrop(){this.reset()}function LightningFlash(){this.timer=0,this.opacity=0}function CandleFlicker(t,i){this.x=t,this.y=i,this.baseRadius=40,this.time=0}function TreeShadow(t,i,e){this.x=t,this.y=i,this.scale=e,this.offset=0}function RainPool(t,i){this.x=t,this.y=i,this.radius=0,this.opacity=.3}function drawSilhouette(){const t=.15*width,i=height-120,e=60,a=80;bgCtx.fillStyle="rgba(0, 0, 0, 0.2)",bgCtx.fillRect(t,i,e,a),bgCtx.beginPath(),bgCtx.ellipse(t+e/2,i+a+10,30,10,0,0,2*Math.PI),bgCtx.fillStyle="rgba(0, 0, 0, 0.1)",bgCtx.fill();const o=.22*width,h=height-100;bgCtx.fillRect(o,h,20,40),bgCtx.beginPath(),bgCtx.arc(o+10,h,5,0,2*Math.PI),bgCtx.fill(),bgCtx.globalCompositeOperation="destination-out",bgCtx.beginPath(),bgCtx.arc(o+10,h+10,15,0,2*Math.PI),bgCtx.fill(),bgCtx.globalCompositeOperation="source-over"}function animate(){bgCtx.fillStyle="#110E19",bgCtx.fillRect(0,0,width,height),lightning.update();let t=.02*Math.sin(1.5*candle.time),i=bgCtx.createLinearGradient(0,0,0,height);i.addColorStop(0,`rgba(120, 90, 150, ${.08+t})`),i.addColorStop(1,"rgba(40, 30, 80, 0.25)"),bgCtx.fillStyle=i,bgCtx.fillRect(0,0,width,height),treeShadows.forEach(t=>t.update()),fogOffset+=.05,bgCtx.globalAlpha=.1,bgCtx.drawImage(fogCanvas,fogOffset%width-width,0),bgCtx.drawImage(fogCanvas,fogOffset%width,0),bgCtx.globalAlpha=1;for(let t of entities)t.update();Math.random()<.03&&pools.push(new RainPool(Math.random()*width,height-10)),pools.forEach(t=>t.update()),pools=pools.filter(t=>t.opacity>0),reflections.forEach(t=>{let i=bgCtx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);i.addColorStop(0,`rgba(255, 255, 255, ${t.opacity})`),i.addColorStop(1,"rgba(255, 255, 255, 0)"),bgCtx.fillStyle=i,bgCtx.beginPath(),bgCtx.arc(t.x,t.y,t.radius,0,2*Math.PI),bgCtx.fill()}),candle.update(),drawSilhouette(),requestAnimFrame(animate)}var requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};const background=document.getElementById("bgCanvas"),bgCtx=background.getContext("2d"),width=1920,height=1080;background.width=width,background.height=height,RainDrop.prototype.reset=function(){const t=.2,i=.5;this.x=width*(Math.random()*(t+1)-t),this.y=height*(Math.random()*(i+1)-i),this.length=20+20*Math.random(),this.speed=4+4*Math.random(),this.opacity=.1+.3*Math.random()},RainDrop.prototype.update=function(){this.y+=this.speed,this.x+=.3*this.speed,this.y>height&&this.reset(),this.draw()},RainDrop.prototype.draw=function(){bgCtx.beginPath(),bgCtx.moveTo(this.x,this.y),bgCtx.lineTo(this.x-2,this.y-this.length),bgCtx.strokeStyle=`rgba(255, 255, 255, ${this.opacity})`,bgCtx.lineWidth=1,bgCtx.stroke()},DripDrop.prototype.reset=function(){this.x=Math.random()*width,this.y=Math.random()*height,this.length=8+15*Math.random(),this.speed=.5+1.5*Math.random(),this.opacity=.1+.15*Math.random()},DripDrop.prototype.update=function(){this.y+=this.speed,this.y>height&&this.reset(),this.draw()},DripDrop.prototype.draw=function(){bgCtx.beginPath(),bgCtx.moveTo(this.x,this.y),bgCtx.lineTo(this.x,this.y-this.length),bgCtx.strokeStyle=`rgba(255, 255, 255, ${this.opacity})`,bgCtx.lineWidth=1,bgCtx.stroke()},LightningFlash.prototype.trigger=function(){this.timer=4+Math.floor(3*Math.random()),this.opacity=.15+.1*Math.random()},LightningFlash.prototype.update=function(){Math.random()<.001&&this.timer<=0&&this.trigger(),this.timer>0&&(this.draw(),this.timer--,this.opacity*=.5)},LightningFlash.prototype.draw=function(){let t=bgCtx.createLinearGradient(0,0,width,height);t.addColorStop(0,`rgba(255, 255, 255, ${this.opacity})`),t.addColorStop(1,`rgba(255, 255, 255, ${.1*this.opacity})`),bgCtx.fillStyle=t,bgCtx.fillRect(0,0,width,height)},CandleFlicker.prototype.update=function(){this.time+=.05,this.draw()},CandleFlicker.prototype.draw=function(){const t=5*Math.sin(2*this.time+.5*Math.random()),i=2*Math.sin(3*this.time+Math.random()),e=this.baseRadius+t,a=.4*this.baseRadius+i;let o=bgCtx.createRadialGradient(this.x,this.y,0,this.x,this.y,e);o.addColorStop(0,"rgba(255, 160, 90, 0.05)"),o.addColorStop(1,"rgba(255, 160, 90, 0)"),bgCtx.fillStyle=o,bgCtx.beginPath(),bgCtx.arc(this.x,this.y,e,0,2*Math.PI),bgCtx.fill();let h=bgCtx.createRadialGradient(this.x,this.y,0,this.x,this.y,a);h.addColorStop(0,"rgba(255, 230, 180, 0.2)"),h.addColorStop(1,"rgba(255, 230, 180, 0)"),bgCtx.fillStyle=h,bgCtx.beginPath(),bgCtx.arc(this.x,this.y,a,0,2*Math.PI),bgCtx.fill()},TreeShadow.prototype.update=function(){this.offset+=.002+.001*Math.random(),this.draw()},TreeShadow.prototype.draw=function(){let t=this.x+10*Math.sin(this.offset),i=150*this.scale,e=50*this.scale,a=4,o=i/a;bgCtx.beginPath();for(let i=0;i<=a;i++){let h=this.y+i*o,n=10*Math.sin(this.offset+.5*i),r=e*(1-i/a);0===i?bgCtx.moveTo(t+n,h):(bgCtx.lineTo(t+n+r,h),bgCtx.lineTo(t+n-r,h))}bgCtx.closePath(),bgCtx.fillStyle="rgba(0, 0, 0, 0.08)",bgCtx.fill()},RainPool.prototype.update=function(){this.radius+=.2,this.opacity-=.003,this.draw()},RainPool.prototype.draw=function(){let t=3;for(let i=0;i<t;i++){let e=this.radius*(.6+.2*i),a=this.opacity*(1-i/t);bgCtx.beginPath(),bgCtx.ellipse(this.x,this.y,1.3*e,.7*e,0,0,2*Math.PI),bgCtx.strokeStyle=`rgba(255, 255, 255, ${a})`,bgCtx.lineWidth=1,bgCtx.stroke()}};var fogCanvas=document.createElement("canvas");fogCanvas.width=width,fogCanvas.height=height;var fogCtx=fogCanvas.getContext("2d");for(let t=0;t<200;t++){let t=Math.random()*width,i=Math.random()*height,e=100+100*Math.random(),a=.01+.03*Math.random();fogCtx.beginPath(),fogCtx.arc(t,i,e,0,2*Math.PI),fogCtx.fillStyle=`rgba(255, 255, 255, ${a})`,fogCtx.fill()}let lightning=new LightningFlash,candle=new CandleFlicker(.25*width,height-80),treeShadows=[new TreeShadow(.3*width,.6*height,1),new TreeShadow(.6*width,.65*height,.8),new TreeShadow(.8*width,.7*height,1.2)],pools=[],entities=[],reflections=[],fogOffset=0;for(let t=0;t<5;t++)reflections.push({x:Math.random()*width,y:Math.random()*height*.5,radius:40+60*Math.random(),opacity:.03+.05*Math.random()});for(var i=0;i<300;i++)entities.push(new RainDrop);for(i=0;i<100;i++)entities.push(new DripDrop);animate();